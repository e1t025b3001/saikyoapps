# 2025-11-18 ゲーム選択画面実装調査

目的
- ユーザがログイン後にゲーム選択画面を表示する要件の調査
  - 画面項目: ユーザーネーム表示、ゲーム選択ボタン（マルバツゲームのみで可）、マッチング開始ボタン（ダミーでよい）

現状確認（ワークスペースの該当箇所）
- 認証設定: `saikyoapps/src/main/java/team1/saikyoapps/config/SecurityConfig.java`
  - ログイン成功後のリダイレクト先は `defaultSuccessUrl("/", true)` に設定されている（トップ `/` に遷移）
- コントローラ: `saikyoapps/src/main/java/team1/saikyoapps/controller/HomeController.java`
  - `@GetMapping("/")` が `index` テンプレートを返す。Authentication からユーザー名を model に `username` として設定している。
- テンプレート: `saikyoapps/src/main/resources/templates/index.html`
  - 現在は "ようこそ {username} さん" とログアウトフォームを表示している。

実装方針候補
1. 既存の `index.html` をゲーム選択画面に拡張する（推奨: 最小の変更で要件を満たす）
   - 理由: 既に `/` へリダイレクトされ、`username` が model に渡されているため、テンプレートの内容を追加するだけで要件を満たせる。
2. 新規テンプレート `select.html` を作成し、`SecurityConfig` の `defaultSuccessUrl` を `/select` に変更する
   - 理由: 画面責務を分離したい場合に有効。ただし `SecurityConfig` とコントローラの修正が必要になる。

必要な変更箇所（実装フェーズで編集するファイル、相対パス）
- `saikyoapps/src/main/resources/templates/index.html`  ← 推奨: ここにゲーム選択 UI を追加
- （オプション）`saikyoapps/src/main/java/team1/saikyoapps/config/SecurityConfig.java`  ← 新規ページにする場合は `defaultSuccessUrl` を `/select` に変更
- （オプション）`saikyoapps/src/main/java/team1/saikyoapps/controller/HomeController.java`  ← 新しい GET ハンドラ `/select` を作る場合に編集

UI 要件（実装に渡す仕様）
- 画面上部に「ようこそ {username} さん」を表示する（既存の `username` モデルを利用）
- ゲーム選択エリア（ボタン）
  - ボタン: 「マルバツゲーム」（選択状態の表示は任意）
  - 今回はマルバツ以外の選択肢は不要
- マッチング開始ボタン（ダミー動作でよい）
  - 押下時に簡易な JavaScript でアラートを出すか、POST 先が未実装でも良い
- ログアウトボタンは現状のまま残す

確認手順 (DoD の案)
1. アプリケーションを起動する: `./gradlew bootRun`（プロジェクトルートで実行）
2. ブラウザで `http://localhost:8080/` にアクセスする
3. ログインページで既存ユーザー（`foo`, `bar`, `buz` のいずれか）でログインする
   - 注意: 現在の `UserDetailsService` はハッシュ化されたパスワードを直接登録しているため、実装側で確認用パスワードをテスト用に用意することを検討する
4. ログイン成功後、ゲーム選択画面が表示され、画面にユーザーネームが表示されていること
5. 「マルバツゲーム」ボタンが存在すること
6. 「マッチング開始」ボタンを押すとダミー動作（例: アラート表示）が実行されること

注意点・検討事項
- テスト用の分かりやすいパスワードを `InMemoryUserDetailsManager` に追加するか、既存のハッシュ値の平文をドキュメントに残すとテストが容易になる。
- 将来的に複数ゲームを増やす可能性がある場合は、テンプレートを分割してコンポーネント化すると良い。
- マッチング機能を本実装する場合はサーバー側でのマッチングAPIや WebSocket の検討が必要（今回はダミーで可）。

次の作業（実装フェーズに移る場合の手順）
1. `index.html` を編集して UI を追加（もしくは `select.html` 作成 + `SecurityConfig` を変更）
2. 動作確認: `./gradlew bootRun` → ログイン → 表示確認
3. 実装完了時に `docs/reports/done/done_YYYY-MM-DD_ゲーム選択実装.md` を作成し、実装手順と確認方法、使用したブランチ名を記載する

参考
- 現在の該当ファイル一覧（実装で編集が必要な候補）
  - `saikyoapps/src/main/java/team1/saikyoapps/config/SecurityConfig.java`
  - `saikyoapps/src/main/java/team1/saikyoapps/controller/HomeController.java`
  - `saikyoapps/src/main/resources/templates/index.html`

以上。実装に移ってよければ、次は「計画」または「実装」を実行します。
