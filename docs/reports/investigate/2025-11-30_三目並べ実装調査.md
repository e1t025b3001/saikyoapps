# 2025-11-30 三目並べ(まるばつ) 実装調査

目的
- 本プロジェクトにおいて、マッチング機能を用いる本来の対戦形式の代わりに、同一端末上で先手→後手を交互に操作して遊べる「三目並べ（まるばつ）」機能を実装するための調査。

調査対象（現状プロジェクト内の関連ファイル）
- `saikyoapps/src/main/resources/templates/matching.html`  （現状のマッチング画面、テンプレートあり）
- `saikyoapps/src/main/java/team1/saikyoapps/controller/MatchingController.java`（マッチング関連コントローラ）
- `saikyoapps/src/main/java/team1/saikyoapps/model/`（モデル群、必要に応じて新規クラスを追加）
- `saikyoapps/src/main/resources/templates/`（他テンプレート群。UI整備はここに追加）

要件（今回の範囲）
- 同一端末で2人（先手・後手）を交互に操作して遊べること
- 勝利判定（横・縦・斜めの3つ連続）を行うこと
- 引き分け判定を行うこと
- UIはブラウザ上で分かりやすく操作できること（クリックで手を置く）
- セッション単位でプレイ状態を保持できること（ページの再読み込みは初期化として扱う）
- 本調査の範囲ではネットワーク対戦（マッチング／WebSocket）は実装しない

実装方針候補（比較）
1) クライアント側（JavaScript）で状態管理・勝敗判定を行う（最も簡単）
   - 画面上に3x3のグリッドを描画し、クリックイベントでマークを配置。
   - JSで現在の手番管理、勝敗・引き分け判定を行い、結果表示とリセットを行う。
   - サーバー側は静的なテンプレート提供のみ。将来的にマッチング化する場合はゲーム履歴送信のAPI追加を検討。
   - メリット: 実装がシンプルでレスポンス速い。フロントエンドの学習効果が高い。
   - デメリット: セッション・永続化が容易でない（今回は不要）。サーバー側の状態がないため将来のマルチプレイヤー対応には拡張が必要。

2) サーバー側（Spring Boot）で状態管理・勝敗判定を行う（セッション保存）
   - サーバーにゲームオブジェクト（例: `TicTacToeGame`）を置き、HttpSessionに保存。
   - クライアントはAJAXでサーバーに手（セル座標）を送信し、サーバーが検証・更新・勝敗判定を返す。
   - メリット: 将来のマッチング/対戦化（WebSocket化）への移行がスムーズ。サーバー側で不正操作を防げる。
   - デメリット: 実装がやや複雑。AJAX処理やセッション管理の実装が必要。

推奨方針
- 今回は「同一端末での操作」という要件と実装範囲から、まずはクライアント側（JavaScript）で完結する実装を推奨します。
  - 理由: 早く動作するプロトタイプが得られ、UIの挙動確認が容易。後で必要に応じてサーバー側に移行（またはAPIを追加）できる。

データ設計（サーバー側で管理する場合の例）
- クラス: `TicTacToeGame`（package: `team1.saikyoapps.model`）
  - フィールド: `int[][] board = new int[3][3]`（0=空, 1=先手, 2=後手）
  - フィールド: `int currentPlayer`（1または2）
  - メソッド: `boolean makeMove(int row, int col)`, `int checkWinner()`（0=なし, 1=先手勝ち, 2=後手勝ち, 3=引き分け）,
    `void reset()`

UI設計
- 新しいテンプレート: `saikyoapps/src/main/resources/templates/tictactoe.html`（もしくは既存の `matching.html` を流用してゲームUIに差し替え）
- 静的リソース: `saikyoapps/src/main/resources/static/js/tictactoe.js` にクリックイベントやゲームロジックを実装。
- 表示内容: 3x3のボタン/セル、現在の手番表示、勝敗表示、リセットボタン。

エンドポイント（サーバー側を使う場合の例）
- GET `/tictactoe` -> ゲーム画面表示（Thymeleaf）
- POST `/tictactoe/move` -> JSONで {row, col} を受け取り、更新後の盤面と結果を返す
- POST `/tictactoe/reset` -> ゲームリセット

テスト計画
- ユニットテスト（サーバー側）
  - `TicTacToeGame` の勝敗判定ロジックの網羅テスト（横／縦／斜め／引き分け）
- E2E/手動テスト
  - ブラウザで `/tictactoe` にアクセスし、先手→後手でクリックして勝敗が正しく表示されることを確認

参考情報・URL
- 三目並べ（Tic-tac-toe） - Wikipedia: https://ja.wikipedia.org/wiki/三目並べ
- Java実装例（参考） - GeeksforGeeks: https://www.geeksforgeeks.org/tic-tac-toe-game-in-java/
- クライアントサイド実装の参考記事: 複数の入門記事（検索で "tic tac toe javascript" を参照）

セキュリティ・運用上の注意
- クライアント側だけで完結する場合、ゲーム状態の改変防止は不要（ローカル遊び）
- 将来的にネットワーク対戦にする場合はCSRF対策、認証済みユーザーの紐付け、WebSocketセッション管理を検討する

次のアクション（ユーザーに確認したい点）
1. 実装を「クライアント側(JS)で完結する簡易版」で進めてよいか確認してください（推奨）
2. サーバー側で状態管理する方法を希望する場合はその旨を教えてください（この場合は計画フェーズで詳細タスクを作成します）

本調査で実施したこと
- 要件を整理し、実装方針の比較、推奨方針を提示しました。

注意: 調査フェーズのルールに従い、本レポート以外でソースコードの変更や新規実装は行っていません。実装を進める場合は次に「計画」フェーズでタスクを作成し、承認後に実装フェーズへ移行します。

作業報告（簡潔）
- 作成物: `docs/reports/investigate/2025-11-30_三目並べ実装調査.md`
- 次にできること: ユーザーの選択に従い「計画」フェーズを作成します（クライアント実装 or サーバー実装）。
