<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>トップ</title>
</head>

<body>
  <h1 th:text="'ようこそ ' + ${username} + ' さん'">ようこそ</h1>

  <!-- ゲーム選択セクションを追加 -->
  <section id="game-select">
    <h2>ゲームを選択してください</h2>
    <div id="game-buttons">
      <!-- 新增多個按鈕，data-game 使用標準化識別字串 -->
      <button class="game-btn" data-game="marubatsu" type="button">マルバツゲーム</button>
      <button class="game-btn" data-game="othello" type="button">オセロ</button>
      <button class="game-btn" data-game="gomoku" type="button">5木並べ</button>
      <button class="game-btn" data-game="shinkeisuijaku" type="button">神経衰弱</button>
      <button class="game-btn" data-game="uno" type="button">UNO</button>
      <button class="game-btn" data-game="darour" type="button">大老二</button>
    </div>

    <div style="margin-top:1em;">
      <!-- マッチング開始 -->
      <button id="start-matching-btn" type="button">マッチング開始</button>
      <!-- 観戦（五目並べ）: 五目並べ選択時のみ表示 -->
      <button id="spectate-gomoku-btn" type="button" style="display:none;margin-left:8px;">観戦（五目並べ）</button>
    </div>
  </section>

  <script>
    (function () {
      const gameButtons = document.querySelectorAll('.game-btn');
      const startBtn = document.getElementById('start-matching-btn');
      const spectateBtn = document.getElementById('spectate-gomoku-btn');
      let selectedGame = null;

      function clearSelectionStyles() {
        gameButtons.forEach(b => {
          b.style.backgroundColor = '';
          b.style.border = '';
        });
      }

      function updateSpectateButtonVisibility() {
        if (!spectateBtn) return;
        spectateBtn.style.display = (selectedGame === 'gomoku') ? '' : 'none';
      }

      gameButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          selectedGame = btn.getAttribute('data-game');
          clearSelectionStyles();
          btn.style.backgroundColor = '#cce5ff';
          btn.style.border = '1px solid #004085';
          updateSpectateButtonVisibility();
        });
      });

      startBtn.addEventListener('click', function () {
        if (!selectedGame) {
          alert('ゲームを選択してください。');
          return;
        }
        const url = '/matching?game=' + encodeURIComponent(selectedGame);
        window.location.href = url;
      });

      if (spectateBtn) {
        spectateBtn.addEventListener('click', function () {
          window.location.href = '/gomoku/spectate';
        });
      }

      // 初期表示
      updateSpectateButtonVisibility();
    })();
  </script>

  <form th:action="@{/logout}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">ログアウト</button>
  </form>
</body>

</html>
