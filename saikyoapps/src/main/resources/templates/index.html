<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title th:text="${i18n_title}"></title>
</head>

<body>
  <h1 th:text="${i18n_title}">ようこそ</h1>

  <!-- ゲーム選択セクションを追加 -->
  <section id="game-select">
    <h2 th:text="#{home.games.select}">ゲームを選択してください</h2>
    <div id="game-buttons">
      <!-- 新增多個按鈕，data-game 使用標準化識別字串 -->
      <button class="game-btn" data-game="marubatsu" type="button" th:text="#{home.games.marubatu}">マルバツゲーム</button>
      <button class="game-btn" data-game="othello" type="button" th:text="#{home.games.Othello}">オセロ</button>
      <button class="game-btn" data-game="gomoku" type="button" th:text="#{home.games.gomoku}">5木並べ</button>
      <button class="game-btn" data-game="shinkeisuijaku" type="button" th:text="#{home.games.memory-game}">神経衰弱</button>
      <button class="game-btn" data-game="uno" type="button">UNO</button>
      <button class="game-btn" data-game="darour" type="button">大老二</button>
    </div>
    <div style="margin-top:1em;">
      <!-- マッチング開始 -->
      <button id="start-matching-btn" type="button" th:text="#{home.match.start}">マッチング開始</button>
      <!-- 観戦（五目並べ）: 五目並べ選択時のみ表示 -->
      <button id="spectate-gomoku-btn" type="button" style="display:none;margin-left:8px;">観戦（五目並べ）</button>
    </div>
  </section>

  <script>
    (function () {
      const gameButtons = document.querySelectorAll('.game-btn');
      const startBtn = document.getElementById('start-matching-btn');
      const spectateBtn = document.getElementById('spectate-gomoku-btn');
      let selectedGame = null;

      function clearSelectionStyles() {
        gameButtons.forEach(b => {
          b.style.backgroundColor = '';
          b.style.border = '';
        });
      }

      function updateSpectateButtonVisibility() {
        if (!spectateBtn) return;
        spectateBtn.style.display = (selectedGame === 'gomoku') ? '' : 'none';
      }

      gameButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          selectedGame = btn.getAttribute('data-game');
          clearSelectionStyles();
          btn.style.backgroundColor = '#cce5ff';
          btn.style.border = '1px solid #004085';
          updateSpectateButtonVisibility();
        });
      });

      startBtn.addEventListener('click', function () {
        if (!selectedGame) {
          alert('ゲームを選択してください。');
          return;
        }
        const url = '/matching?game=' + encodeURIComponent(selectedGame);
        window.location.href = url;
      });

      if (spectateBtn) {
        spectateBtn.addEventListener('click', function () {
          window.location.href = '/gomoku/spectate';
        });
      }

      // 初期表示
      updateSpectateButtonVisibility();
    })();
  </script>

  <form th:action="@{/logout}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit" th:text="#{home.match.logout}">ログアウト</button>
  </form>

  <form th:action="@{/i18n}" method="post" id="i18n-form">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <input id="radio1" type="radio" name="i18n" value="ja" th:checked="${i18n == 'ja'}" />
    <label for="radio1">日本語</label>
    <input id="radio2" type="radio" name="i18n" value="zh_TW" th:checked="${i18n == 'zh_TW'}" />
    <label for="radio2">中国語(繁體字)</label>
    <button type="submit" id="save-i18n-btn" style="display:none;">保存</button>
  </form>

  <div id="i18n-root" th:attr="data-current=${i18n}" style="display:none"></div>

  <script th:inline="javascript">
    /*<![CDATA[*/
    (function () {
      const form = document.getElementById('i18n-form');
      const saveBtn = document.getElementById('save-i18n-btn');
      const radios = Array.from(form.querySelectorAll('input[type="radio"][name="i18n"]'));
      const current = document.getElementById('i18n-root').dataset.current || 'ja';

      function updateSaveVisibility() {
        const selected = radios.find(r => r.checked).value;
        if (selected !== current) {
          saveBtn.style.display = '';
        } else {
          saveBtn.style.display = 'none';
        }
      }

      radios.forEach(r => r.addEventListener('change', updateSaveVisibility));
      updateSaveVisibility();
    })();
    /*]]>*/
  </script>

</body>

</html>
