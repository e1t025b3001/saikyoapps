<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>SaikyoApps</title>
  <link rel="stylesheet" th:href="@{/css/main.css}" />
  <link rel="stylesheet" th:href="@{/css/index.css}" />
</head>

<body data-page="index">
  <div class="container section-center">
    <h1>ゲーム一覧</h1>
    <div id="game-buttons">
      <a th:href="@{/matching(game='marubatsu')}" class="game-btn" data-game="marubatsu">マルバツ</a>
      <a th:href="@{/matching(game='gomoku')}" class="game-btn" data-game="gomoku">五目並べ</a>
      <a th:href="@{/matching(game='othello')}" class="game-btn" data-game="othello">オセロ</a>
      <a th:href="@{/matching(game='shinkeisuijaku')}" class="game-btn" data-game="shinkeisuijaku">神経衰弱</a>
      <a th:href="@{/matching(game='uno')}" class="game-btn" data-game="uno">UNO</a>
      <a th:href="@{/matching(game='dairo')}" class="game-btn" data-game="dairo">大老二</a>
    </div>

    <!-- 追加: 選擇遊戲後的操作按鈕（Matching / Spectate） -->
    <div id="game-actions" style="margin-top:16px; display:flex; gap:8px; justify-content:center;">
      <button id="start-matching-btn" class="btn primary">マッチング</button>
      <button id="spectate-btn" class="btn" style="display:none;">観戦</button>
    </div>
  </div>

  <script>
    (function () {
      const gameButtons = document.querySelectorAll('.game-btn');
      const startBtn = document.getElementById('start-matching-btn');
      const spectateBtn = document.getElementById('spectate-btn');
      let selectedGame = null;

      // どのゲームが観戦をサポートするか
      const spectateSupportedGames = ['gomoku'];

      function clearSelectionStyles() {
        gameButtons.forEach(b => {
          b.style.backgroundColor = '';
          b.style.border = '';
        });
      }

      function updateSpectateButtonVisibility() {
        if (!spectateBtn) return;
        spectateBtn.style.display = spectateSupportedGames.includes(selectedGame) ? '' : 'none';
      }

      gameButtons.forEach(btn => {
        btn.addEventListener('click', function (e) {
          // prevent immediate navigation so user can select and then choose action
          e.preventDefault();
          selectedGame = btn.getAttribute('data-game');
          clearSelectionStyles();
          btn.style.backgroundColor = '#cce5ff';
          btn.style.border = '1px solid #004085';
          updateSpectateButtonVisibility();
        });
      });

      if (startBtn) {
        startBtn.addEventListener('click', function () {
          if (!selectedGame) {
            alert('ゲームを選択してください。');
            return;
          }
          const url = '/matching?game=' + encodeURIComponent(selectedGame);
          window.location.href = url;
        });
      }

      if (spectateBtn) {
        spectateBtn.addEventListener('click', function () {
          if (!selectedGame) { alert('先にゲームを選択してください。'); return; }
          if (!spectateSupportedGames.includes(selectedGame)) { alert('このゲームは観戦できません。'); return; }
          const url = '/' + encodeURIComponent(selectedGame) + '/spectate';
          window.location.href = url;
        });
      }

      // 初期表示
      updateSpectateButtonVisibility();
    })();
  </script>

  <form th:action="@{/logout}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">ログアウト</button>
  </form>
</body>

</html>
