<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title th:text="#{title.darour}">大老二</title>
  <link rel="stylesheet" th:href="@{/css/main.css}" />
  <link rel="stylesheet" th:href="@{/css/darour.css}" />
</head>

<body data-game="darour">
  <main class="container section-center">
    <th:block th:if="${matchId != null}">
      <!-- Top bar with title and forfeit button -->
      <div class="top-bar">
        <h1 th:text="#{title.darour}">大老二</h1>
        <form th:action="@{/match/forfeit}" method="post">
          <input type="hidden" name="game" value="darour" />
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <button type="submit" class="btn secondary" th:text="#{button.forfeit}">投降</button>
        </form>
      </div>

      <!-- Reference panel toggle button -->
      <button id="reference-toggle" onclick="toggleReference()">?</button>

      <!-- Reference panel for suits and combinations -->
      <div id="reference-panel" class="hidden">
        <button class="ref-close" onclick="toggleReference()">×</button>

        <div class="ref-section">
          <div class="ref-label" th:text="#{darour.ref.suits}">スート</div>
          <div class="ref-row suit-row">
            <span class="suit-spade">♠</span> &gt;
            <span class="suit-heart">♥</span> &gt;
            <span class="suit-diamond">♦</span> &gt;
            <span class="suit-club">♣</span>
          </div>
        </div>

        <div class="ref-section">
          <div class="ref-label" th:text="#{darour.ref.ranks}">ランク</div>
          <div class="ref-row">
            2 &gt; A &gt; K &gt; Q &gt; J &gt; 10 &gt; 9 &gt; ... &gt; 3
          </div>
        </div>

        <div class="ref-section">
          <div class="ref-label" th:text="#{darour.ref.rules}">ルール</div>
          <div class="ref-rules">
            <div th:text="'・' + #{darour.ref.rule1}">・同じ枚数しか出せません．</div>
            <div th:text="'・' + #{darour.ref.rule2}">・より強い役を出す必要があります．</div>
            <div th:text="'・' + #{darour.ref.rule3}">・全員パスすると，場のカードが捨てられます．</div>
            <div th:text="'・' + #{darour.ref.rule4}">・手札を0枚にした人の勝ち！</div>
          </div>
        </div>

        <div class="ref-section">
          <div class="ref-label" th:text="#{darour.ref.fivecard}">5枚役の強さ</div>
          <div class="ref-hands">
            <div class="ref-hand">
              <span class="ref-rank">1</span>
              <div class="mini-cards">
                <span class="mini-card suit-spade">10</span>
                <span class="mini-card suit-spade">J</span>
                <span class="mini-card suit-spade">Q</span>
                <span class="mini-card suit-spade">K</span>
                <span class="mini-card suit-spade">A</span>
              </div>
              <span class="ref-name" th:text="#{darour.hand.royalflush}">ロイヤルフラッシュ</span>
            </div>
            <div class="ref-hand">
              <span class="ref-rank">2</span>
              <div class="mini-cards">
                <span class="mini-card suit-heart">5</span>
                <span class="mini-card suit-heart">6</span>
                <span class="mini-card suit-heart">7</span>
                <span class="mini-card suit-heart">8</span>
                <span class="mini-card suit-heart">9</span>
              </div>
              <span class="ref-name" th:text="#{darour.hand.straightflush}">ストレートフラッシュ</span>
            </div>
            <div class="ref-hand">
              <span class="ref-rank">3</span>
              <div class="mini-cards">
                <span class="mini-card suit-spade">7</span>
                <span class="mini-card suit-heart">7</span>
                <span class="mini-card suit-club">7</span>
                <span class="mini-card suit-diamond">7</span>
                <span class="mini-card suit-club">K</span>
              </div>
              <span class="ref-name" th:text="#{darour.hand.fourofakind}">フォーカード</span>
            </div>
            <div class="ref-hand">
              <span class="ref-rank">4</span>
              <div class="mini-cards">
                <span class="mini-card suit-spade">Q</span>
                <span class="mini-card suit-heart">Q</span>
                <span class="mini-card suit-club">Q</span>
                <span class="mini-card suit-heart">4</span>
                <span class="mini-card suit-diamond">4</span>
              </div>
              <span class="ref-name" th:text="#{darour.hand.fullhouse}">フルハウス</span>
            </div>
            <div class="ref-hand">
              <span class="ref-rank">5</span>
              <div class="mini-cards">
                <span class="mini-card suit-club">2</span>
                <span class="mini-card suit-club">5</span>
                <span class="mini-card suit-club">8</span>
                <span class="mini-card suit-club">J</span>
                <span class="mini-card suit-club">A</span>
              </div>
              <span class="ref-name" th:text="#{darour.hand.flush}">フラッシュ</span>
            </div>
            <div class="ref-hand">
              <span class="ref-rank">6</span>
              <div class="mini-cards">
                <span class="mini-card suit-diamond">3</span>
                <span class="mini-card suit-club">4</span>
                <span class="mini-card suit-heart">5</span>
                <span class="mini-card suit-spade">6</span>
                <span class="mini-card suit-diamond">7</span>
              </div>
              <span class="ref-name" th:text="#{darour.hand.straight}">ストレート</span>
            </div>
          </div>
        </div>
      </div>

      <script>
        function toggleReference() {
          document.getElementById('reference-panel').classList.toggle('hidden');
        }
      </script>

      <div id="game-container" class="card">
        <div id="status-bar">
          <div id="current-turn">
            <span id="turn-indicator"></span>
            <span id="turn-player-name"></span>
          </div>
        </div>

        <div id="opponents-area">
          <div class="opponent" id="opponent-left">
            <div class="opponent-name"></div>
            <div class="opponent-cards">
              <span class="card-count"></span>
            </div>
          </div>
          <div class="opponent" id="opponent-right">
            <div class="opponent-name"></div>
            <div class="opponent-cards">
              <span class="card-count"></span>
            </div>
          </div>
        </div>

        <div id="table-area">
          <div id="table-label" th:text="#{darour.table.label}">場札</div>
          <div id="table-cards"></div>
          <div id="combination-type"></div>
        </div>

        <div id="my-area">
          <div id="my-info">
            <span id="my-name" th:text="${username}"></span>
            <span id="my-card-count"></span>
          </div>
          <div id="my-hand"></div>
        </div>

        <div id="action-buttons">
          <button id="play-btn" class="btn" disabled th:text="#{darour.button.play}">出す</button>
          <button id="pass-btn" class="btn secondary" disabled th:text="#{darour.button.pass}">パス</button>
        </div>

        <div id="message-area"></div>
      </div>

      <div id="result-overlay" class="hidden">
        <div id="result-content">
          <h2 id="result-title"></h2>
          <p id="result-message"></p>
          <a href="/" class="btn" th:text="#{darour.button.returnlobby}">ロビーに戻る</a>
        </div>
      </div>

    </th:block>

    <th:block th:if="${matchId == null}">
      <p th:text="#{darour.loading}">読み込み中...</p>
      <script>
        (function () {
          setTimeout(function () {
            window.location.href = '/darour';
          }, 1500);
        })();
      </script>
    </th:block>
  </main>

  <input type="hidden" id="matchId" name="matchId" th:value="${matchId}" />
  <input type="hidden" id="username" th:value="${username}" />
  <input type="hidden" name="_csrf" th:value="${_csrf.token}" />

  <!-- i18n messages for JavaScript -->
  <input type="hidden" id="i18n-cards-suffix" th:value="#{darour.cards.suffix}" />
  <input type="hidden" id="i18n-newround" th:value="#{darour.newround}" />
  <input type="hidden" id="i18n-turn-yours" th:value="#{darour.turn.yours}" />
  <input type="hidden" id="i18n-turn-other" th:value="#{darour.turn.other}" />
  <input type="hidden" id="i18n-result-win" th:value="#{darour.result.win}" />
  <input type="hidden" id="i18n-result-congrats" th:value="#{darour.result.congrats}" />
  <input type="hidden" id="i18n-result-lose" th:value="#{darour.result.lose}" />
  <input type="hidden" id="i18n-result-winner" th:value="#{darour.result.winner}" />
  <input type="hidden" id="i18n-error-fetchstate" th:value="#{darour.error.fetchstate}" />
  <input type="hidden" id="i18n-error-invalidcombination" th:value="#{darour.error.invalidcombination}" />
  <input type="hidden" id="i18n-success-played" th:value="#{darour.success.played}" />
  <input type="hidden" id="i18n-error-playfailed" th:value="#{darour.error.playfailed}" />
  <input type="hidden" id="i18n-error-network" th:value="#{darour.error.network}" />
  <input type="hidden" id="i18n-success-passed" th:value="#{darour.success.passed}" />
  <input type="hidden" id="i18n-error-passfailed" th:value="#{darour.error.passfailed}" />
  <input type="hidden" id="i18n-hand-single" th:value="#{darour.hand.single}" />
  <input type="hidden" id="i18n-hand-pair" th:value="#{darour.hand.pair}" />
  <input type="hidden" id="i18n-hand-threeofakind" th:value="#{darour.hand.threeofakind}" />
  <input type="hidden" id="i18n-hand-straight" th:value="#{darour.hand.straight}" />
  <input type="hidden" id="i18n-hand-flush" th:value="#{darour.hand.flush}" />
  <input type="hidden" id="i18n-hand-fullhouse" th:value="#{darour.hand.fullhouse}" />
  <input type="hidden" id="i18n-hand-fourofakind" th:value="#{darour.hand.fourofakind}" />
  <input type="hidden" id="i18n-hand-straightflush" th:value="#{darour.hand.straightflush}" />

  <script th:if="${matchId != null}" src="/js/darour.js"></script>
</body>

</html>
